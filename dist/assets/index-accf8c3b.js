(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();function D(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function I(i,e=!1){const t=D(),a=`_${t}`;return Object.defineProperty(window,a,{value:n=>(e&&Reflect.deleteProperty(window,a),i==null?void 0:i(n)),writable:!1,configurable:!0}),t}async function A(i,e={}){return new Promise((t,a)=>{const n=I(l=>{t(l),Reflect.deleteProperty(window,`_${s}`)},!0),s=I(l=>{a(l),Reflect.deleteProperty(window,`_${n}`)},!0);window.__TAURI_IPC__({cmd:i,callback:n,error:s,...e})})}async function r(i){return A("tauri",i)}async function P(i={}){return typeof i=="object"&&Object.freeze(i),r({__tauriModule:"Dialog",message:{cmd:"openDialog",options:i}})}async function $(i,e){return r({__tauriModule:"Event",message:{cmd:"unlisten",event:i,eventId:e}})}async function B(i,e,t){await r({__tauriModule:"Event",message:{cmd:"emit",event:i,windowLabel:e,payload:t}})}async function T(i,e,t){return r({__tauriModule:"Event",message:{cmd:"listen",event:i,windowLabel:e,handler:I(t)}}).then(a=>async()=>$(i,a))}async function k(i,e,t){return T(i,e,a=>{t(a),$(i,a.id).catch(()=>{})})}var g;(function(i){i.WINDOW_RESIZED="tauri://resize",i.WINDOW_MOVED="tauri://move",i.WINDOW_CLOSE_REQUESTED="tauri://close-requested",i.WINDOW_CREATED="tauri://window-created",i.WINDOW_DESTROYED="tauri://destroyed",i.WINDOW_FOCUS="tauri://focus",i.WINDOW_BLUR="tauri://blur",i.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",i.WINDOW_THEME_CHANGED="tauri://theme-changed",i.WINDOW_FILE_DROP="tauri://file-drop",i.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",i.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",i.MENU="tauri://menu",i.CHECK_UPDATE="tauri://update",i.UPDATE_AVAILABLE="tauri://update-available",i.INSTALL_UPDATE="tauri://update-install",i.STATUS_UPDATE="tauri://update-status",i.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(g||(g={}));var C;(function(i){i[i.Audio=1]="Audio",i[i.Cache=2]="Cache",i[i.Config=3]="Config",i[i.Data=4]="Data",i[i.LocalData=5]="LocalData",i[i.Desktop=6]="Desktop",i[i.Document=7]="Document",i[i.Download=8]="Download",i[i.Executable=9]="Executable",i[i.Font=10]="Font",i[i.Home=11]="Home",i[i.Picture=12]="Picture",i[i.Public=13]="Public",i[i.Runtime=14]="Runtime",i[i.Template=15]="Template",i[i.Video=16]="Video",i[i.Resource=17]="Resource",i[i.App=18]="App",i[i.Log=19]="Log",i[i.Temp=20]="Temp",i[i.AppConfig=21]="AppConfig",i[i.AppData=22]="AppData",i[i.AppLocalData=23]="AppLocalData",i[i.AppCache=24]="AppCache",i[i.AppLog=25]="AppLog"})(C||(C={}));var S;(function(i){i[i.JSON=1]="JSON",i[i.Text=2]="Text",i[i.Binary=3]="Binary"})(S||(S={}));function E(){return navigator.appVersion.includes("Win")}E();E();class F{constructor(e,t){this.type="Logical",this.width=e,this.height=t}}class v{constructor(e,t){this.type="Physical",this.width=e,this.height=t}toLogical(e){return new F(this.width/e,this.height/e)}}class N{constructor(e,t){this.type="Logical",this.x=e,this.y=t}}class M{constructor(e,t){this.type="Physical",this.x=e,this.y=t}toLogical(e){return new N(this.x/e,this.y/e)}}var _;(function(i){i[i.Critical=1]="Critical",i[i.Informational=2]="Informational"})(_||(_={}));function L(){return window.__TAURI_METADATA__.__windows.map(i=>new b(i.label,{skip:!0}))}const W=["tauri://created","tauri://error"];class z{constructor(e){this.label=e,this.listeners=Object.create(null)}async listen(e,t){return this._handleTauriEvent(e,t)?Promise.resolve(()=>{const a=this.listeners[e];a.splice(a.indexOf(t),1)}):T(e,this.label,t)}async once(e,t){return this._handleTauriEvent(e,t)?Promise.resolve(()=>{const a=this.listeners[e];a.splice(a.indexOf(t),1)}):k(e,this.label,t)}async emit(e,t){if(W.includes(e)){for(const a of this.listeners[e]||[])a({event:e,id:-1,windowLabel:this.label,payload:t});return Promise.resolve()}return B(e,this.label,t)}_handleTauriEvent(e,t){return W.includes(e)?(e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t],!0):!1}}class O extends z{async scaleFactor(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"scaleFactor"}}}})}async innerPosition(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"innerPosition"}}}}).then(({x:e,y:t})=>new M(e,t))}async outerPosition(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"outerPosition"}}}}).then(({x:e,y:t})=>new M(e,t))}async innerSize(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"innerSize"}}}}).then(({width:e,height:t})=>new v(e,t))}async outerSize(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"outerSize"}}}}).then(({width:e,height:t})=>new v(e,t))}async isFullscreen(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isFullscreen"}}}})}async isMinimized(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMinimized"}}}})}async isMaximized(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMaximized"}}}})}async isFocused(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isFocused"}}}})}async isDecorated(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isDecorated"}}}})}async isResizable(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isResizable"}}}})}async isMaximizable(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMaximizable"}}}})}async isMinimizable(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMinimizable"}}}})}async isClosable(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isClosable"}}}})}async isVisible(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isVisible"}}}})}async title(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"title"}}}})}async theme(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"theme"}}}})}async center(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"center"}}}})}async requestUserAttention(e){let t=null;return e&&(e===_.Critical?t={type:"Critical"}:t={type:"Informational"}),r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"requestUserAttention",payload:t}}}})}async setResizable(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setResizable",payload:e}}}})}async setMaximizable(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMaximizable",payload:e}}}})}async setMinimizable(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMinimizable",payload:e}}}})}async setClosable(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setClosable",payload:e}}}})}async setTitle(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setTitle",payload:e}}}})}async maximize(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"maximize"}}}})}async unmaximize(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"unmaximize"}}}})}async toggleMaximize(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"toggleMaximize"}}}})}async minimize(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"minimize"}}}})}async unminimize(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"unminimize"}}}})}async show(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"show"}}}})}async hide(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"hide"}}}})}async close(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"close"}}}})}async setDecorations(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setDecorations",payload:e}}}})}async setAlwaysOnTop(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setAlwaysOnTop",payload:e}}}})}async setContentProtected(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setContentProtected",payload:e}}}})}async setSize(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setSize",payload:{type:e.type,data:{width:e.width,height:e.height}}}}}})}async setMinSize(e){if(e&&e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMinSize",payload:e?{type:e.type,data:{width:e.width,height:e.height}}:null}}}})}async setMaxSize(e){if(e&&e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMaxSize",payload:e?{type:e.type,data:{width:e.width,height:e.height}}:null}}}})}async setPosition(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `position` argument must be either a LogicalPosition or a PhysicalPosition instance");return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setPosition",payload:{type:e.type,data:{x:e.x,y:e.y}}}}}})}async setFullscreen(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setFullscreen",payload:e}}}})}async setFocus(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setFocus"}}}})}async setIcon(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setIcon",payload:{icon:typeof e=="string"?e:Array.from(e)}}}}})}async setSkipTaskbar(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setSkipTaskbar",payload:e}}}})}async setCursorGrab(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorGrab",payload:e}}}})}async setCursorVisible(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorVisible",payload:e}}}})}async setCursorIcon(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorIcon",payload:e}}}})}async setCursorPosition(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `position` argument must be either a LogicalPosition or a PhysicalPosition instance");return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorPosition",payload:{type:e.type,data:{x:e.x,y:e.y}}}}}})}async setIgnoreCursorEvents(e){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setIgnoreCursorEvents",payload:e}}}})}async startDragging(){return r({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"startDragging"}}}})}async onResized(e){return this.listen(g.WINDOW_RESIZED,t=>{t.payload=Y(t.payload),e(t)})}async onMoved(e){return this.listen(g.WINDOW_MOVED,t=>{t.payload=H(t.payload),e(t)})}async onCloseRequested(e){return this.listen(g.WINDOW_CLOSE_REQUESTED,t=>{const a=new R(t);Promise.resolve(e(a)).then(()=>{if(!a.isPreventDefault())return this.close()})})}async onFocusChanged(e){const t=await this.listen(g.WINDOW_FOCUS,n=>{e({...n,payload:!0})}),a=await this.listen(g.WINDOW_BLUR,n=>{e({...n,payload:!1})});return()=>{t(),a()}}async onScaleChanged(e){return this.listen(g.WINDOW_SCALE_FACTOR_CHANGED,e)}async onMenuClicked(e){return this.listen(g.MENU,e)}async onFileDropEvent(e){const t=await this.listen(g.WINDOW_FILE_DROP,s=>{e({...s,payload:{type:"drop",paths:s.payload}})}),a=await this.listen(g.WINDOW_FILE_DROP_HOVER,s=>{e({...s,payload:{type:"hover",paths:s.payload}})}),n=await this.listen(g.WINDOW_FILE_DROP_CANCELLED,s=>{e({...s,payload:{type:"cancel"}})});return()=>{t(),a(),n()}}async onThemeChanged(e){return this.listen(g.WINDOW_THEME_CHANGED,e)}}class R{constructor(e){this._preventDefault=!1,this.event=e.event,this.windowLabel=e.windowLabel,this.id=e.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}}class b extends O{constructor(e,t={}){super(e),t!=null&&t.skip||r({__tauriModule:"Window",message:{cmd:"createWebview",data:{options:{label:e,...t}}}}).then(async()=>this.emit("tauri://created")).catch(async a=>this.emit("tauri://error",a))}static getByLabel(e){return L().some(t=>t.label===e)?new b(e,{skip:!0}):null}static async getFocusedWindow(){for(const e of L())if(await e.isFocused())return e;return null}}"__TAURI_METADATA__"in window?new b(window.__TAURI_METADATA__.__currentWindow.label,{skip:!0}):(console.warn(`Could not find "window.__TAURI_METADATA__". The "appWindow" value will reference the "main" window label.
Note that this is not an issue if running this frontend on a browser instead of a Tauri window.`),new b("main",{skip:!0}));function H(i){return new M(i.x,i.y)}function Y(i){return new v(i.width,i.height)}E();const y=A;class V{constructor(){this.secretSeed="Eric2025ImageOverlay"}generateMonthlyPassword(e,t){const n=`${`${e}-${t.toString().padStart(2,"0")}`}_${this.secretSeed}`;let s=0;for(let o=0;o<n.length;o++){const c=n.charCodeAt(o);s=(s<<5)-s+c,s=s&s}return(Math.abs(s)%1e8).toString().padStart(8,"0")}getCurrentMonthPassword(){const e=new Date;return this.generateMonthlyPassword(e.getFullYear(),e.getMonth()+1)}validatePassword(e){const t=this.getCurrentMonthPassword();return e===t}getNextMonthPassword(){const e=new Date;let t=e.getMonth()+2,a=e.getFullYear();return t>12&&(t=1,a++),this.generateMonthlyPassword(a,t)}}class X{constructor(){this.passwordManager=new V,this.isLoggedIn=!1,this.initializeElements(),this.attachEventListeners(),this.checkMonthlyAuth()}initializeElements(){this.loginScreen=document.getElementById("loginScreen"),this.mainScreen=document.getElementById("mainScreen"),this.passwordInput=document.getElementById("passwordInput"),this.loginBtn=document.getElementById("loginBtn"),this.loginError=document.getElementById("loginError"),this.logoutBtn=document.getElementById("logoutBtn")}checkMonthlyAuth(){try{const e=new Date,t=`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}`;localStorage.getItem("imageOverlayAuthMonth")===t?(this.isLoggedIn=!0,this.showMainScreen(),console.log("이번 달 이미 인증됨 - 자동 로그인")):(this.showLoginScreen(),console.log("새로운 달 또는 처음 실행 - 로그인 필요"))}catch(e){console.error("월별 인증 확인 오류:",e),this.showLoginScreen()}}attachEventListeners(){this.loginBtn.addEventListener("click",()=>this.handleLogin()),this.logoutBtn.addEventListener("click",()=>this.handleLogout()),this.passwordInput.addEventListener("keypress",e=>{e.key==="Enter"&&this.handleLogin()})}handleLogin(){const e=this.passwordInput.value.trim();if(!e){this.showError("비밀번호를 입력해주세요.");return}if(this.passwordManager.validatePassword(e)){this.isLoggedIn=!0;const t=new Date,a=`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}`;try{localStorage.setItem("imageOverlayAuthMonth",a),console.log("월별 인증 정보 저장:",a)}catch(n){console.error("인증 정보 저장 오류:",n)}this.showMainScreen(),this.showSuccessMessage("로그인 성공! 이번 달 동안 재로그인이 필요하지 않습니다.")}else this.showError("잘못된 비밀번호입니다. 비밀번호는 매달 갱신됩니다."),this.passwordInput.value=""}handleLogout(){this.isLoggedIn=!1;try{localStorage.removeItem("imageOverlayAuthMonth"),console.log("인증 정보 삭제됨")}catch(e){console.error("인증 정보 삭제 오류:",e)}this.showLoginScreen(),this.passwordInput.value="",this.clearError()}showLoginScreen(){this.loginScreen.style.display="block",this.mainScreen.style.display="none",this.passwordInput.focus()}showMainScreen(){this.loginScreen.style.display="none",this.mainScreen.style.display="block"}showError(e){this.loginError.textContent=e,this.loginError.style.color="#e74c3c"}showSuccessMessage(e){this.loginError.textContent=e,this.loginError.style.color="#2ecc71"}clearError(){this.loginError.textContent=""}checkLoginStatus(){return this.isLoggedIn}}class Z{constructor(){this.inputPath="",this.outputPath="",this.images=[],this.isBatchMode=!0,this.isAutoText=!0,this.selectedImageIndex=0,this.selectedImageIndexForPreview=0,this.currentSettings={fontSize:20,positionX:10,positionY:10,text:""},this.updatePreviewDebounced=this.debounce(this.updatePreview.bind(this),150),this.updateIndividualPreviewDebounced=this.debounce(this.updateIndividualPreview.bind(this),150),this.previewCache=new Map,this.cacheMaxSize=20,this.isUpdatingSelectAll=!1,this.notificationTimer=null,this.loginManager=new X,this.initializeElements(),this.attachEventListeners(),this.loginManager.checkLoginStatus()&&this.showNotification("프로그램이 초기화되었습니다.","success")}initializeElements(){this.inputFolderBtn=document.getElementById("inputFolderBtn"),this.outputFolderBtn=document.getElementById("outputFolderBtn"),this.inputFolderPath=document.getElementById("inputFolderPath"),this.outputFolderPath=document.getElementById("outputFolderPath"),this.toggleBatchBtn=document.getElementById("toggleBatchBtn"),this.toggleIndividualBtn=document.getElementById("toggleIndividualBtn"),this.startBtn=document.getElementById("startBtn"),this.batchModal=document.getElementById("batchModal"),this.closeBatchModal=document.getElementById("closeBatchModal"),this.toggleAutoTextBtn=document.getElementById("toggleAutoTextBtn"),this.toggleCustomTextBtn=document.getElementById("toggleCustomTextBtn"),this.customTextGroup=document.getElementById("customTextGroup"),this.customText=document.getElementById("customText"),this.fontSize=document.getElementById("fontSize"),this.fontSizeValue=document.getElementById("fontSizeValue"),this.positionX=document.getElementById("positionX"),this.posXValue=document.getElementById("posXValue"),this.positionY=document.getElementById("positionY"),this.posYValue=document.getElementById("posYValue"),this.previewImage=document.getElementById("previewImage"),this.thumbnailsContainer=document.getElementById("thumbnailsContainer"),this.cancelBatchBtn=document.getElementById("cancelBatchBtn"),this.saveBatchBtn=document.getElementById("saveBatchBtn"),this.individualModal=document.getElementById("individualModal"),this.closeIndividualModal=document.getElementById("closeIndividualModal"),this.indFontSize=document.getElementById("indFontSize"),this.indFontSizeValue=document.getElementById("indFontSizeValue"),this.indPositionX=document.getElementById("indPositionX"),this.indPosXValue=document.getElementById("indPosXValue"),this.indPositionY=document.getElementById("indPositionY"),this.indPosYValue=document.getElementById("indPosYValue"),this.indPreviewImage=document.getElementById("indPreviewImage"),this.individualImageContainer=document.getElementById("individualImageContainer"),this.cancelIndividualBtn=document.getElementById("cancelIndividualBtn"),this.saveIndividualBtn=document.getElementById("saveIndividualBtn"),this.logModal=document.getElementById("logModal"),this.closeLogModal=document.getElementById("closeLogModal"),this.logContent=document.getElementById("logContent"),this.confirmLogBtn=document.getElementById("confirmLogBtn"),this.notification=document.getElementById("notification"),this.positionX.value=10,this.posXValue.textContent="10",this.positionY.value=10,this.posYValue.textContent="10",this.indPositionX.value=10,this.indPosXValue.textContent="10",this.indPositionY.value=10,this.indPosYValue.textContent="10"}removeFileExtension(e){const t=e.lastIndexOf(".");return t===-1?e:e.substring(0,t)}normalizeKoreanText(e){if(!e)return e;try{const a=e.normalize("NFC").replace(/[\u200B-\u200D\uFEFF]/g,"");return console.log(`한글 정규화: "${e}" -> "${a}"`),a}catch(t){return console.warn("한글 정규화 실패:",t),e}}getCacheKey(e,t,a,n,s){return`${e}_${t}_${a}_${n}_${s}`}addToCache(e,t){if(this.previewCache.size>=this.cacheMaxSize){const a=this.previewCache.keys().next().value;this.previewCache.delete(a)}this.previewCache.set(e,t)}getFromCache(e){return this.previewCache.get(e)}clearCache(){this.previewCache.clear()}debounce(e,t){let a;return function(...n){clearTimeout(a),a=setTimeout(()=>e.apply(this,n),t)}}updateImageSelection(e,t){console.log(`이미지 선택 상태 업데이트: ${this.images[e].name} -> ${t}`),this.images[e].selected=t;const a=document.querySelector(`[data-container-index="${e}"]`);if(!a){console.error(`컨테이너를 찾을 수 없습니다: index ${e}`);return}const n=a.querySelector('input[type="checkbox"]'),s=a.querySelector("img"),l=a.querySelector('input[type="text"]'),o=a.querySelector("[data-filename-display]");n&&(n.checked=t),a.style.border=t?"2px solid #dc3545":"1px solid #dee2e6",a.style.backgroundColor=t?"#fff5f5":"#ffffff",s&&this.images[e].thumbnailData&&(s.src=this.images[e].thumbnailData,s.style.display="block",s.style.opacity=t?"1":"0.6"),o&&(o.style.color=t?"#dc3545":"#333",o.style.fontWeight=t?"bold":"normal",o.textContent=`${t?"✅ ":"❌ "}${this.images[e].name}`),l&&(l.disabled=!t,l.style.border=`1px solid ${t?"#dc3545":"#ccc"}`,l.style.backgroundColor=t?"#ffffff":"#f8f9fa")}updateSelectAllLabel(){if(this.isUpdatingSelectAll)return;const e=document.getElementById("selectAllCheckbox");if(!e)return;const t=this.images.filter(s=>s.selected).length,a=this.images.length;this.isUpdatingSelectAll=!0,e.checked=t===a,e.indeterminate=t>0&&t<a;const n=e.closest("label");if(n){const s=Array.from(n.childNodes).filter(l=>l.nodeType===Node.TEXT_NODE);if(s.length>0)s[0].textContent=` 전체 선택 (선택됨: ${t}/${a})`;else{const l=document.createTextNode(` 전체 선택 (선택됨: ${t}/${a})`);n.appendChild(l)}}this.isUpdatingSelectAll=!1,console.log(`전체 선택 라벨 업데이트: ${t}/${a}개 선택됨`)}handleSelectAllChange(e){if(this.isUpdatingSelectAll){console.log("전체 선택 업데이트 중... 무시");return}const t=e.target.checked;console.log(`전체 선택 변경 시작: ${t}`),this.images.forEach((a,n)=>{this.updateImageSelection(n,t)}),this.updateIndividualPreviewDebounced(),console.log(`전체 선택 변경 완료: ${this.images.filter(a=>a.selected).length}/${this.images.length}개 선택됨`)}attachEventListeners(){this.inputFolderBtn.addEventListener("click",()=>this.selectInputFolder()),this.outputFolderBtn.addEventListener("click",()=>this.selectOutputFolder()),this.toggleBatchBtn.addEventListener("click",()=>this.toggleMode(!0)),this.toggleIndividualBtn.addEventListener("click",()=>this.toggleMode(!1)),this.startBtn.addEventListener("click",()=>this.startProcessing()),this.closeBatchModal.addEventListener("click",()=>this.closeBatchModalHandler()),this.toggleAutoTextBtn.addEventListener("click",()=>this.toggleTextMode(!0)),this.toggleCustomTextBtn.addEventListener("click",()=>this.toggleTextMode(!1)),this.fontSize.addEventListener("input",e=>{this.fontSizeValue.textContent=e.target.value,this.currentSettings.fontSize=parseInt(e.target.value),this.updatePreviewDebounced()}),this.positionX.addEventListener("input",e=>{this.posXValue.textContent=e.target.value,this.currentSettings.positionX=parseInt(e.target.value),this.updatePreviewDebounced()}),this.positionY.addEventListener("input",e=>{this.posYValue.textContent=e.target.value,this.currentSettings.positionY=parseInt(e.target.value),this.updatePreviewDebounced()}),this.cancelBatchBtn.addEventListener("click",()=>this.closeBatchModalHandler()),this.saveBatchBtn.addEventListener("click",()=>this.processBatchImages()),this.closeIndividualModal.addEventListener("click",()=>this.closeIndividualModalHandler()),this.indFontSize.addEventListener("input",e=>{this.indFontSizeValue.textContent=e.target.value,this.updateIndividualPreviewDebounced()}),this.indPositionX.addEventListener("input",e=>{this.indPosXValue.textContent=e.target.value,this.updateIndividualPreviewDebounced()}),this.indPositionY.addEventListener("input",e=>{this.indPosYValue.textContent=e.target.value,this.updateIndividualPreviewDebounced()}),this.cancelIndividualBtn.addEventListener("click",()=>this.closeIndividualModalHandler()),this.saveIndividualBtn.addEventListener("click",()=>this.processIndividualImages()),this.closeLogModal.addEventListener("click",()=>this.closeLogModalHandler()),this.confirmLogBtn.addEventListener("click",()=>this.closeLogModalHandler()),this.customText.addEventListener("input",e=>{const t=this.normalizeKoreanText(e.target.value);if(t!==e.target.value){const a=e.target.selectionStart,n=e.target.selectionEnd;e.target.value=t,e.target.setSelectionRange(a,n)}this.updatePreviewDebounced()}),window.addEventListener("click",e=>{e.target===this.batchModal&&this.closeBatchModalHandler(),e.target===this.individualModal&&this.closeIndividualModalHandler(),e.target===this.logModal&&this.closeLogModalHandler()})}async selectInputFolder(){if(!this.loginManager.checkLoginStatus()){this.showNotification("로그인이 필요합니다.","error");return}try{const e=await P({directory:!0,multiple:!1,title:"입력 폴더 선택"});e&&(this.inputPath=e,this.inputFolderPath.textContent=e,this.showNotification("입력 폴더가 선택되었습니다.","success"),await this.loadImages())}catch(e){console.error("입력 폴더 선택 오류:",e),this.showNotification("폴더 선택 중 오류가 발생했습니다.","error")}}async selectOutputFolder(){if(!this.loginManager.checkLoginStatus()){this.showNotification("로그인이 필요합니다.","error");return}try{const e=await P({directory:!0,multiple:!1,title:"출력 폴더 선택"});e&&(this.outputPath=e,this.outputFolderPath.textContent=e,this.showNotification("출력 폴더가 선택되었습니다.","success"))}catch(e){console.error("출력 폴더 선택 오류:",e),this.showNotification("폴더 선택 중 오류가 발생했습니다.","error")}}async loadImages(){try{const e=await y("get_image_files",{folderPath:this.inputPath});this.images=e.map(t=>{const a=t.split("/").pop()||t.split("\\\\").pop(),n=this.removeFileExtension(a),s=this.normalizeKoreanText(n);return{path:t,name:a,nameWithoutExtension:s,text:"",selected:!0,thumbnailData:null,thumbnailLoaded:!1}}),console.log(`${this.images.length}개의 이미지가 로드되었습니다:`,this.images),this.showNotification(`${this.images.length}개의 이미지가 로드되었습니다.`,"success"),this.loadThumbnails()}catch(e){console.error("이미지 로드 오류:",e),this.showNotification("이미지 로드 중 오류가 발생했습니다.","error"),this.images=[]}}toggleMode(e){this.isBatchMode=e,this.toggleBatchBtn.classList.toggle("active",e),this.toggleIndividualBtn.classList.toggle("active",!e)}toggleTextMode(e){this.isAutoText=e,this.toggleAutoTextBtn.classList.toggle("active",e),this.toggleCustomTextBtn.classList.toggle("active",!e),this.customTextGroup.style.display=e?"none":"block",this.updatePreviewDebounced()}startProcessing(){if(!this.loginManager.checkLoginStatus()){this.showNotification("로그인이 필요합니다.","error");return}if(!this.inputPath||!this.outputPath){this.showNotification("입력 폴더와 출력 폴더를 선택해주세요.","error");return}if(this.images.length===0){this.showNotification("처리할 이미지가 없습니다.","error");return}this.isBatchMode?this.openBatchModal():this.openIndividualModal()}openBatchModal(){this.batchModal.style.display="block",this.createThumbnails(),this.updatePreview()}closeBatchModalHandler(){this.batchModal.style.display="none"}openIndividualModal(){this.individualModal.style.display="block",this.createIndividualImageList(),this.updateIndividualPreview()}closeIndividualModalHandler(){this.individualModal.style.display="none"}closeLogModalHandler(){this.logModal.style.display="none"}async loadThumbnails(){console.log("썸네일 로딩 시작...");const e=3;for(let t=0;t<this.images.length;t+=e){const a=this.images.slice(t,t+e);await Promise.all(a.map(async(n,s)=>{try{const l=await y("get_image_thumbnail",{imagePath:n.path});n.thumbnailData=l,n.thumbnailLoaded=!0,this.updateThumbnailInUI(t+s),console.log(`썸네일 로드 완료: ${n.name}`)}catch(l){console.error(`썸네일 로드 실패 (${n.name}):`,l),n.thumbnailLoaded=!0}})),t+e<this.images.length&&await new Promise(n=>setTimeout(n,50))}console.log("모든 썸네일 로딩 완료")}updateThumbnailInUI(e){const t=document.querySelector(`[data-image-index="${e}"] img`);t&&this.images[e].thumbnailData&&(t.src=this.images[e].thumbnailData,t.style.display="block");const a=document.querySelector(`[data-image-index="${e}"]`);a&&this.images[e].thumbnailData&&(a.src=this.images[e].thumbnailData,a.style.display="block",console.log(`개별 이미지 리스트 썸네일 업데이트: ${this.images[e].name}`))}createThumbnails(){if(this.thumbnailsContainer.innerHTML="",this.images.length===0){this.thumbnailsContainer.innerHTML="<p>이미지가 없습니다.</p>";return}this.images.forEach((e,t)=>{const a=document.createElement("div");a.className=`thumbnail ${t===this.selectedImageIndex?"selected":""}`,a.setAttribute("data-image-index",t);const n=e.thumbnailData||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiNmMGYwZjAiLz48dGV4dCB4PSI1MCIgeT0iNTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzk5OTk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9IjAuM2VtIj5Mb2FkaW5nLi4uPC90ZXh0Pjwvc3ZnPg==",s=e.thumbnailData?"block":"none";a.innerHTML=`
        <img src="${n}" alt="${e.name}" style="display: ${s};">
        <div class="thumbnail-label">${e.name}</div>
      `,a.addEventListener("click",()=>{document.querySelectorAll(".thumbnail").forEach(l=>l.classList.remove("selected")),a.classList.add("selected"),this.selectedImageIndex=t,this.updatePreviewDebounced()}),this.thumbnailsContainer.appendChild(a)})}createIndividualImageList(){if(this.individualImageContainer.innerHTML="",this.images.length===0){this.individualImageContainer.innerHTML="<p>이미지가 없습니다.</p>";return}const e=document.createElement("div");e.style.marginBottom="1rem",e.style.padding="0.5rem",e.style.backgroundColor="#f8f9fa",e.style.borderRadius="4px",e.style.border="1px solid #dee2e6";const t=this.images.filter(s=>s.selected).length;e.innerHTML=`
      <div style="display: flex; align-items: center; justify-content: space-between;">
        <label style="display: flex; align-items: center; cursor: pointer; font-weight: bold;">
          <input type="checkbox" id="selectAllCheckbox" 
            ${t===this.images.length?"checked":""} 
                 style="margin-right: 0.5rem; transform: scale(1.2);">
          전체 선택 (선택됨: ${t}/${this.images.length})
        </label>
        <div style="font-size: 0.85em; color: #6c757d;">
        ✅ 체크된 이미지만 처리됩니다
      </div>
      </div>
    `,this.individualImageContainer.appendChild(e),document.getElementById("selectAllCheckbox").addEventListener("change",s=>this.handleSelectAllChange(s)),this.images.forEach((s,l)=>{const o=document.createElement("div");o.className="card image-card",o.style.marginBottom="1rem",o.style.position="relative",o.style.transition="all 0.2s ease",o.style.cursor="pointer",o.style.border=s.selected?"2px solid #dc3545":"1px solid #dee2e6",o.style.backgroundColor=s.selected?"#fff5f5":"#ffffff",o.setAttribute("data-container-index",l);const c=s.thumbnailData||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIGZpbGw9IiNmMGYwZjAiLz48dGV4dCB4PSIzMCIgeT0iMzAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI4IiBmaWxsPSIjOTk5OTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iMC4zZW0iPuuhnOuUqS4uLjwvdGV4dD48L3N2Zz4=",u=s.thumbnailData?"block":"none";o.innerHTML=`
        <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
          <div style="margin-right: 1rem; display: flex; align-items: center;">
            <input type="checkbox" ${s.selected?"checked":""} 
                   style="margin-right: 8px; transform: scale(1.3); cursor: pointer;">
            <img src="${c}" alt="${s.name}" 
                 style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; display: ${u};">
          </div>
          <div style="flex: 1;">
            <div style="font-weight: bold; margin-bottom: 0.3rem; color: ${s.selected?"#dc3545":"#333"};"
                 data-filename-display="${l}">
              ${s.selected?"✅ ":"❌ "}${s.name}
            </div>
            <input type="text" 
                   placeholder="이 이미지에 추가할 텍스트를 입력하세요" 
                   style="width: 100%; padding: 0.3rem; border-radius: 4px; 
                          border: 1px solid ${s.selected?"#dc3545":"#ccc"};
                          background-color: ${s.selected?"#ffffff":"#f8f9fa"};" 
                   ${s.selected?"":"disabled"}>
          </div>
        </div>
      `,o.querySelector('input[type="checkbox"]').addEventListener("change",h=>{const p=h.target.checked;console.log(`체크박스 변경: ${s.name} -> ${p}`),this.updateImageSelection(l,p),this.updateSelectAllLabel(),this.updateIndividualPreviewDebounced()}),o.addEventListener("click",h=>{h.target.type==="checkbox"||h.target.type==="text"||(console.log(`이미지 카드 클릭: ${s.name} (인덱스: ${l})`),this.selectedImageIndexForPreview=l,this.updateIndividualPreviewDebounced(),document.querySelectorAll(".image-card").forEach(p=>{p.style.boxShadow=""}),o.style.boxShadow="0 4px 12px rgba(0,123,255,0.3)",this.showNotification(`${s.name}의 미리보기를 표시합니다`,"success"))});const m=o.querySelector('input[type="text"]');m.value=s.text,m.addEventListener("input",h=>{const p=this.normalizeKoreanText(h.target.value);if(this.images[l].text=p,p!==h.target.value){const f=h.target.selectionStart,w=h.target.selectionEnd;h.target.value=p,h.target.setSelectionRange(f,w)}this.selectedImageIndexForPreview===l&&this.updateIndividualPreviewDebounced()}),this.individualImageContainer.appendChild(o)});const n=this.images.findIndex(s=>s.selected);this.selectedImageIndexForPreview=n!==-1?n:0,console.log(`초기 미리보기 이미지 설정: 인덱스 ${this.selectedImageIndexForPreview}`)}async updatePreview(){if(this.images.length===0||this.selectedImageIndex>=this.images.length){this.previewImage.src="",this.previewImage.alt="이미지가 없습니다.";return}const e=this.images[this.selectedImageIndex],t=this.isAutoText?e.nameWithoutExtension:this.customText.value,a=this.getCacheKey(e.path,t,this.currentSettings.fontSize,this.currentSettings.positionX,this.currentSettings.positionY),n=this.getFromCache(a);if(n){this.previewImage.src=n,this.previewImage.alt=e.name;return}console.log(`미리보기 업데이트: ${e.name}, 텍스트: "${t}"`);try{const s=await this.getImageDimensions(e.path),l=this.calculateScaledFontSize(s,this.currentSettings.fontSize),o=this.calculateRightBasedPosition(s,this.currentSettings.positionX,this.currentSettings.positionY,l,t),c=Math.max(0,Math.floor(o.x))||0,u=Math.max(0,Math.floor(o.y))||0,d=Math.max(10,Math.floor(l))||20,m=await y("get_image_preview_lightweight",{imagePath:e.path,text:t||e.nameWithoutExtension,fontSize:d,positionX:c,positionY:u});this.previewImage.src=m,this.previewImage.alt=e.name,this.addToCache(a,m)}catch(s){console.error("미리보기 생성 실패:",s),this.clearCache(),e.thumbnailData?(this.previewImage.src=e.thumbnailData,this.previewImage.alt=e.name):(this.previewImage.src="",this.previewImage.alt="이미지 로드 실패")}}async updateIndividualPreview(){if(this.images.length===0){this.indPreviewImage.src="",this.indPreviewImage.alt="이미지가 없습니다.";return}const e=this.selectedImageIndexForPreview;if(e>=this.images.length||e<0){this.indPreviewImage.src="",this.indPreviewImage.alt="유효하지 않은 이미지";return}const t=this.images[e],a=t.text||t.nameWithoutExtension,n=parseInt(this.indFontSize.value),s=parseInt(this.indPositionX.value),l=parseInt(this.indPositionY.value),o=this.getCacheKey(t.path,a,n,s,l),c=this.getFromCache(o);if(c){this.indPreviewImage.src=c,this.indPreviewImage.alt=`${t.name} - 미리보기 (캐시)`;return}console.log(`개별 미리보기 업데이트: ${t.name}, 텍스트: "${a}"`);try{const u=await this.getImageDimensions(t.path),d=this.calculateScaledFontSize(u,n),m=this.calculateRightBasedPosition(u,s,l,d,a),h=Math.max(0,Math.floor(m.x))||0,p=Math.max(0,Math.floor(m.y))||0,f=Math.max(10,Math.floor(d))||20,w=await y("get_image_preview_lightweight",{imagePath:t.path,text:a||t.nameWithoutExtension,fontSize:f,positionX:h,positionY:p});this.indPreviewImage.src=w,this.indPreviewImage.alt=`${t.name} - 미리보기`,this.addToCache(o,w)}catch(u){console.error("개별 미리보기 생성 실패:",u),t.thumbnailData?(this.indPreviewImage.src=t.thumbnailData,this.indPreviewImage.alt=t.name):(this.indPreviewImage.src="",this.indPreviewImage.alt="이미지 로드 실패")}}async processBatchImages(){const e=[];try{this.showNotification("이미지 처리를 시작합니다...","success"),this.clearCache();for(let t=0;t<this.images.length;t++){const a=this.images[t],n=this.isAutoText?a.nameWithoutExtension:this.customText.value;try{const s=await this.getImageDimensions(a.path),l=this.calculateScaledFontSize(s,this.currentSettings.fontSize),o=this.calculateRightBasedPosition(s,this.currentSettings.positionX,this.currentSettings.positionY,l,n);console.log(`${a.name}: ${s.width}x${s.height}, 위치: (${o.x}, ${o.y}), 크기: ${l}px`);const c=Math.max(0,Math.floor(o.x))||0,u=Math.max(0,Math.floor(o.y))||0,d=Math.max(10,Math.floor(l))||20,m=await y("process_image",{imagePath:a.path,outputPath:this.outputPath,text:n||a.nameWithoutExtension,fontSize:d,positionX:c,positionY:u});m.success?e.push({type:"success",message:`✓ ${a.name} 처리 완료`}):e.push({type:"error",message:`✗ ${a.name} 처리 실패: ${m.error}`})}catch(s){console.error(`${a.name} 처리 중 오류:`,s),e.push({type:"error",message:`✗ ${a.name} 처리 실패: ${s.message}`})}}}catch(t){console.error("일괄 처리 오류:",t),e.push({type:"error",message:`처리 중 오류 발생: ${t.message}`})}this.closeBatchModalHandler(),this.showProcessingResults(e)}async processIndividualImages(){const e=[],t=this.images.filter(a=>a.selected);if(t.length===0){this.showNotification("선택된 이미지가 없습니다.","error");return}try{this.showNotification(`선택된 ${t.length}개 이미지 처리를 시작합니다...`,"success"),this.clearCache();const a=parseInt(this.indFontSize.value),n=parseInt(this.indPositionX.value),s=parseInt(this.indPositionY.value);for(let o=0;o<t.length;o++){const c=t[o],u=c.text||c.nameWithoutExtension;try{const d=await this.getImageDimensions(c.path),m=this.calculateScaledFontSize(d,a),h=this.calculateRightBasedPosition(d,n,s,m,u);console.log(`${c.name}: ${d.width}x${d.height}, 위치: (${h.x}, ${h.y}), 크기: ${m}px`);const p=Math.max(0,Math.floor(h.x))||0,f=Math.max(0,Math.floor(h.y))||0,w=Math.max(10,Math.floor(m))||20,x=await y("process_image",{imagePath:c.path,outputPath:this.outputPath,text:u||c.nameWithoutExtension,fontSize:w,positionX:p,positionY:f});x.success?e.push({type:"success",message:`✓ ${c.name} 처리 완료`}):e.push({type:"error",message:`✗ ${c.name} 처리 실패: ${x.error}`})}catch(d){console.error(`${c.name} 처리 중 오류:`,d),e.push({type:"error",message:`✗ ${c.name} 처리 실패: ${d.message}`})}}this.images.filter(o=>!o.selected).forEach(o=>{e.push({type:"info",message:`⏭️ ${o.name} 건너뛰기 (선택 안됨)`})})}catch(a){console.error("개별 처리 오류:",a),e.push({type:"error",message:`처리 중 오류 발생: ${a.message}`})}this.closeIndividualModalHandler(),this.showProcessingResults(e)}async getImageDimensions(e){try{return await y("get_image_dimensions",{imagePath:e})}catch(t){return console.error("이미지 크기 가져오기 오류:",t),{width:400,height:300}}}calculateScaledFontSize(e,t){const n=e.width*e.height,s=Math.sqrt(n/12e4),l=Math.max(.5,Math.min(s,3)),o=t*l;return Math.max(10,Math.min(Math.round(o),200))}calculateRightBasedPosition(e,t,a,n=20,s="Sample"){const l=this.estimateTextWidth(s,n),o=n,c=2;let u=e.width*(1-t/100)-l,d=e.height*(1-a/100)-o;return u=Math.max(c,Math.min(u,e.width-l-c)),d=Math.max(c,Math.min(d,e.height-o-c)),{x:Math.round(u),y:Math.round(d)}}estimateTextWidth(e,t){if(!e)return 10;let a=0;e.length;for(let s=0;s<e.length;s++){const l=e[s];let o;l==="1"?o=t*.2:["i","l","!","|","I","j",".",","].includes(l)?o=t*.25:["t","f","r","'",'"'].includes(l)?o=t*.35:["W","M"].includes(l)?o=t*.7:["w","m"].includes(l)?o=t*.65:l===" "?o=t*.2:l>="가"&&l<="힣"?o=t*.7:l>="ㄱ"&&l<="ㅎ"?o=t*.4:l>="ㅏ"&&l<="ㅣ"?o=t*.3:l>="ㅤ"&&l<="ㆎ"?o=t*.45:["0","8"].includes(l)?o=t*.5:l>="2"&&l<="7"||l==="9"?o=t*.45:["A","H","N","U","V","X","Y","Z"].includes(l)?o=t*.55:["Q","G","O","D"].includes(l)?o=t*.6:["B","C","E","F","K","L","P","R","S","T","J"].includes(l)||["a","c","e","g","o","q","s"].includes(l)||["b","d","h","k","n","p","u","v","x","y","z"].includes(l)?o=t*.5:l==="-"?o=t*.35:["_","=","+"].includes(l)?o=t*.4:["@","%","#","&"].includes(l)?o=t*.6:o=t*.45,a+=o}const n=a*1.1;return Math.round(Math.max(10,Math.min(n,t*e.length*.8)))}showProcessingResults(e){this.logContent.innerHTML="",e.forEach(o=>{const c=document.createElement("div");c.className=`log-entry log-${o.type}`,o.type==="info"&&(c.style.color="#6c757d",c.style.backgroundColor="#f8f9fa",c.style.border="1px solid #dee2e6",c.style.padding="0.25rem 0.5rem",c.style.borderRadius="4px",c.style.margin="2px 0"),c.textContent=o.message,this.logContent.appendChild(c)}),this.logModal.style.display="block";const t=e.filter(o=>o.type==="success").length,a=e.filter(o=>o.type==="error").length,n=e.filter(o=>o.type==="info").length,s=t+a;let l="";s===0?l="처리된 이미지가 없습니다.":a===0?l=`모든 이미지 처리가 완료되었습니다! (처리: ${t}개${n>0?`, 건너뛰기: ${n}개`:""})`:l=`${t}/${s} 이미지 처리 완료${n>0?` (건너뛰기: ${n}개)`:""}`,this.showNotification(l,a===0?"success":"error")}showNotification(e,t="success"){this.notificationTimer&&clearTimeout(this.notificationTimer),this.notification.textContent=e,this.notification.className=`notification ${t}`,this.notification.style.display="block",this.notificationTimer=setTimeout(()=>{this.notification.style.display="none"},2500)}}document.addEventListener("DOMContentLoaded",()=>{new Z});
